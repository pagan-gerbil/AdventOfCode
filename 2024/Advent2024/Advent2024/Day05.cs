using AdventUtils;

namespace Advent2024;

internal class Day05 : DayBase
{
    protected override string _sample1 => "47|53\r\n97|13\r\n97|61\r\n97|47\r\n75|29\r\n61|13\r\n75|53\r\n29|13\r\n97|29\r\n53|29\r\n61|53\r\n97|53\r\n61|29\r\n47|13\r\n75|47\r\n97|75\r\n47|61\r\n75|61\r\n47|29\r\n75|13\r\n53|13\r\n\r\n75,47,61,53,29\r\n97,61,53,29,13\r\n75,29,13\r\n75,97,47,61,53\r\n61,13,29\r\n97,13,75,29,47";

    protected override string _part1 => "11|42\r\n53|45\r\n53|81\r\n21|97\r\n21|88\r\n21|22\r\n29|27\r\n29|78\r\n29|81\r\n29|66\r\n64|63\r\n64|52\r\n64|92\r\n64|82\r\n64|72\r\n56|36\r\n56|29\r\n56|78\r\n56|73\r\n56|55\r\n56|84\r\n59|18\r\n59|14\r\n59|13\r\n59|19\r\n59|88\r\n59|75\r\n59|16\r\n42|41\r\n42|16\r\n42|53\r\n42|56\r\n42|52\r\n42|59\r\n42|88\r\n42|29\r\n13|43\r\n13|79\r\n13|11\r\n13|97\r\n13|27\r\n13|45\r\n13|42\r\n13|66\r\n13|21\r\n16|18\r\n16|78\r\n16|41\r\n16|75\r\n16|13\r\n16|68\r\n16|54\r\n16|82\r\n16|84\r\n16|88\r\n79|36\r\n79|52\r\n79|82\r\n79|63\r\n79|53\r\n79|75\r\n79|72\r\n79|91\r\n79|78\r\n79|18\r\n79|73\r\n68|69\r\n68|76\r\n68|32\r\n68|45\r\n68|27\r\n68|42\r\n68|66\r\n68|21\r\n68|71\r\n68|11\r\n68|54\r\n68|95\r\n72|92\r\n72|66\r\n72|65\r\n72|13\r\n72|68\r\n72|71\r\n72|76\r\n72|81\r\n72|21\r\n72|73\r\n72|11\r\n72|15\r\n72|54\r\n78|66\r\n78|81\r\n78|69\r\n78|92\r\n78|94\r\n78|71\r\n78|53\r\n78|36\r\n78|33\r\n78|14\r\n78|82\r\n78|27\r\n78|13\r\n78|93\r\n52|75\r\n52|29\r\n52|18\r\n52|27\r\n52|14\r\n52|72\r\n52|68\r\n52|91\r\n52|73\r\n52|93\r\n52|54\r\n52|78\r\n52|94\r\n52|84\r\n52|19\r\n54|76\r\n54|85\r\n54|63\r\n54|33\r\n54|65\r\n54|66\r\n54|97\r\n54|79\r\n54|69\r\n54|42\r\n54|64\r\n54|11\r\n54|95\r\n54|55\r\n54|27\r\n54|71\r\n95|43\r\n95|59\r\n95|85\r\n95|97\r\n95|79\r\n95|29\r\n95|96\r\n95|75\r\n95|91\r\n95|42\r\n95|16\r\n95|63\r\n95|41\r\n95|88\r\n95|78\r\n95|64\r\n95|32\r\n55|45\r\n55|52\r\n55|18\r\n55|91\r\n55|79\r\n55|64\r\n55|59\r\n55|41\r\n55|63\r\n55|96\r\n55|85\r\n55|16\r\n55|42\r\n55|95\r\n55|76\r\n55|43\r\n55|22\r\n55|97\r\n85|22\r\n85|16\r\n85|41\r\n85|78\r\n85|79\r\n85|63\r\n85|14\r\n85|32\r\n85|29\r\n85|97\r\n85|53\r\n85|56\r\n85|91\r\n85|59\r\n85|52\r\n85|43\r\n85|19\r\n85|96\r\n85|75\r\n14|71\r\n14|65\r\n14|84\r\n14|93\r\n14|54\r\n14|45\r\n14|42\r\n14|76\r\n14|13\r\n14|81\r\n14|27\r\n14|94\r\n14|68\r\n14|11\r\n14|95\r\n14|82\r\n14|15\r\n14|66\r\n14|69\r\n14|73\r\n32|75\r\n32|41\r\n32|19\r\n32|36\r\n32|43\r\n32|14\r\n32|96\r\n32|52\r\n32|59\r\n32|79\r\n32|72\r\n32|78\r\n32|53\r\n32|29\r\n32|63\r\n32|56\r\n32|82\r\n32|64\r\n32|84\r\n32|91\r\n32|22\r\n27|71\r\n27|16\r\n27|43\r\n27|45\r\n27|64\r\n27|79\r\n27|96\r\n27|42\r\n27|21\r\n27|81\r\n27|63\r\n27|11\r\n27|66\r\n27|85\r\n27|33\r\n27|55\r\n27|15\r\n27|69\r\n27|97\r\n27|65\r\n27|76\r\n27|59\r\n36|53\r\n36|94\r\n36|54\r\n36|76\r\n36|45\r\n36|15\r\n36|73\r\n36|65\r\n36|13\r\n36|92\r\n36|69\r\n36|82\r\n36|84\r\n36|33\r\n36|93\r\n36|81\r\n36|55\r\n36|72\r\n36|14\r\n36|27\r\n36|71\r\n36|66\r\n36|11\r\n15|42\r\n15|91\r\n15|41\r\n15|65\r\n15|97\r\n15|22\r\n15|43\r\n15|18\r\n15|64\r\n15|79\r\n15|21\r\n15|96\r\n15|32\r\n15|76\r\n15|11\r\n15|88\r\n15|85\r\n15|95\r\n15|52\r\n15|63\r\n15|59\r\n15|56\r\n15|16\r\n15|45\r\n19|94\r\n19|13\r\n19|82\r\n19|14\r\n19|73\r\n19|33\r\n19|69\r\n19|76\r\n19|27\r\n19|15\r\n19|72\r\n19|45\r\n19|55\r\n19|66\r\n19|81\r\n19|92\r\n19|54\r\n19|68\r\n19|93\r\n19|53\r\n19|11\r\n19|36\r\n19|71\r\n19|84\r\n97|29\r\n97|78\r\n97|64\r\n97|53\r\n97|63\r\n97|43\r\n97|52\r\n97|91\r\n97|18\r\n97|22\r\n97|16\r\n97|14\r\n97|79\r\n97|32\r\n97|75\r\n97|88\r\n97|59\r\n97|36\r\n97|82\r\n97|96\r\n97|72\r\n97|19\r\n97|56\r\n97|41\r\n75|71\r\n75|55\r\n75|69\r\n75|15\r\n75|33\r\n75|82\r\n75|84\r\n75|93\r\n75|92\r\n75|73\r\n75|19\r\n75|78\r\n75|94\r\n75|54\r\n75|36\r\n75|81\r\n75|27\r\n75|68\r\n75|14\r\n75|13\r\n75|72\r\n75|53\r\n75|66\r\n75|11\r\n22|91\r\n22|75\r\n22|88\r\n22|56\r\n22|72\r\n22|14\r\n22|19\r\n22|13\r\n22|92\r\n22|52\r\n22|68\r\n22|27\r\n22|73\r\n22|41\r\n22|93\r\n22|36\r\n22|78\r\n22|94\r\n22|82\r\n22|29\r\n22|84\r\n22|54\r\n22|53\r\n22|18\r\n91|68\r\n91|81\r\n91|75\r\n91|71\r\n91|82\r\n91|92\r\n91|33\r\n91|27\r\n91|73\r\n91|56\r\n91|36\r\n91|19\r\n91|13\r\n91|54\r\n91|93\r\n91|18\r\n91|94\r\n91|14\r\n91|84\r\n91|72\r\n91|69\r\n91|53\r\n91|78\r\n91|29\r\n92|97\r\n92|76\r\n92|21\r\n92|13\r\n92|45\r\n92|69\r\n92|81\r\n92|54\r\n92|42\r\n92|68\r\n92|95\r\n92|32\r\n92|11\r\n92|15\r\n92|93\r\n92|33\r\n92|66\r\n92|27\r\n92|71\r\n92|55\r\n92|73\r\n92|65\r\n92|94\r\n92|85\r\n66|43\r\n66|22\r\n66|88\r\n66|79\r\n66|55\r\n66|21\r\n66|41\r\n66|63\r\n66|95\r\n66|64\r\n66|11\r\n66|85\r\n66|97\r\n66|59\r\n66|91\r\n66|45\r\n66|65\r\n66|42\r\n66|76\r\n66|16\r\n66|96\r\n66|52\r\n66|32\r\n66|15\r\n65|79\r\n65|41\r\n65|19\r\n65|18\r\n65|85\r\n65|95\r\n65|22\r\n65|91\r\n65|56\r\n65|43\r\n65|88\r\n65|64\r\n65|63\r\n65|75\r\n65|52\r\n65|16\r\n65|59\r\n65|78\r\n65|97\r\n65|21\r\n65|96\r\n65|29\r\n65|32\r\n65|42\r\n88|93\r\n88|19\r\n88|73\r\n88|36\r\n88|27\r\n88|81\r\n88|69\r\n88|53\r\n88|92\r\n88|54\r\n88|18\r\n88|68\r\n88|84\r\n88|91\r\n88|13\r\n88|75\r\n88|78\r\n88|29\r\n88|82\r\n88|56\r\n88|72\r\n88|94\r\n88|71\r\n88|14\r\n84|92\r\n84|95\r\n84|85\r\n84|13\r\n84|73\r\n84|65\r\n84|33\r\n84|66\r\n84|45\r\n84|42\r\n84|76\r\n84|11\r\n84|68\r\n84|97\r\n84|94\r\n84|21\r\n84|71\r\n84|15\r\n84|27\r\n84|55\r\n84|54\r\n84|81\r\n84|69\r\n84|93\r\n94|81\r\n94|93\r\n94|13\r\n94|32\r\n94|79\r\n94|85\r\n94|21\r\n94|69\r\n94|15\r\n94|71\r\n94|11\r\n94|68\r\n94|33\r\n94|55\r\n94|65\r\n94|76\r\n94|95\r\n94|64\r\n94|54\r\n94|27\r\n94|97\r\n94|66\r\n94|45\r\n94|42\r\n18|69\r\n18|29\r\n18|81\r\n18|72\r\n18|92\r\n18|73\r\n18|93\r\n18|75\r\n18|53\r\n18|54\r\n18|56\r\n18|78\r\n18|71\r\n18|82\r\n18|66\r\n18|36\r\n18|68\r\n18|84\r\n18|27\r\n18|14\r\n18|33\r\n18|13\r\n18|94\r\n18|19\r\n81|11\r\n81|45\r\n81|63\r\n81|95\r\n81|22\r\n81|66\r\n81|15\r\n81|96\r\n81|43\r\n81|59\r\n81|41\r\n81|32\r\n81|33\r\n81|64\r\n81|85\r\n81|42\r\n81|79\r\n81|97\r\n81|21\r\n81|16\r\n81|55\r\n81|76\r\n81|65\r\n81|71\r\n93|45\r\n93|96\r\n93|21\r\n93|27\r\n93|33\r\n93|64\r\n93|85\r\n93|11\r\n93|15\r\n93|43\r\n93|59\r\n93|79\r\n93|97\r\n93|32\r\n93|63\r\n93|76\r\n93|42\r\n93|95\r\n93|55\r\n93|71\r\n93|81\r\n93|65\r\n93|69\r\n93|66\r\n82|92\r\n82|81\r\n82|94\r\n82|93\r\n82|73\r\n82|66\r\n82|21\r\n82|45\r\n82|27\r\n82|13\r\n82|69\r\n82|76\r\n82|95\r\n82|15\r\n82|71\r\n82|54\r\n82|11\r\n82|84\r\n82|68\r\n82|42\r\n82|55\r\n82|85\r\n82|65\r\n82|33\r\n71|15\r\n71|76\r\n71|32\r\n71|21\r\n71|79\r\n71|64\r\n71|97\r\n71|22\r\n71|11\r\n71|33\r\n71|85\r\n71|16\r\n71|96\r\n71|42\r\n71|52\r\n71|43\r\n71|95\r\n71|41\r\n71|59\r\n71|66\r\n71|63\r\n71|65\r\n71|55\r\n71|45\r\n41|88\r\n41|92\r\n41|36\r\n41|53\r\n41|69\r\n41|19\r\n41|91\r\n41|27\r\n41|78\r\n41|93\r\n41|84\r\n41|73\r\n41|29\r\n41|13\r\n41|14\r\n41|54\r\n41|82\r\n41|72\r\n41|94\r\n41|52\r\n41|56\r\n41|18\r\n41|68\r\n41|75\r\n63|43\r\n63|59\r\n63|14\r\n63|22\r\n63|88\r\n63|73\r\n63|96\r\n63|56\r\n63|75\r\n63|82\r\n63|52\r\n63|18\r\n63|16\r\n63|91\r\n63|19\r\n63|36\r\n63|94\r\n63|72\r\n63|84\r\n63|53\r\n63|78\r\n63|41\r\n63|29\r\n63|92\r\n33|96\r\n33|85\r\n33|41\r\n33|65\r\n33|66\r\n33|22\r\n33|95\r\n33|64\r\n33|32\r\n33|52\r\n33|45\r\n33|16\r\n33|55\r\n33|42\r\n33|21\r\n33|79\r\n33|97\r\n33|11\r\n33|59\r\n33|76\r\n33|15\r\n33|43\r\n33|63\r\n33|88\r\n43|14\r\n43|72\r\n43|41\r\n43|82\r\n43|78\r\n43|53\r\n43|56\r\n43|52\r\n43|91\r\n43|16\r\n43|96\r\n43|75\r\n43|18\r\n43|22\r\n43|92\r\n43|88\r\n43|68\r\n43|73\r\n43|59\r\n43|94\r\n43|84\r\n43|29\r\n43|19\r\n43|36\r\n96|88\r\n96|78\r\n96|94\r\n96|84\r\n96|75\r\n96|68\r\n96|53\r\n96|91\r\n96|52\r\n96|56\r\n96|16\r\n96|19\r\n96|59\r\n96|22\r\n96|73\r\n96|14\r\n96|82\r\n96|29\r\n96|36\r\n96|54\r\n96|72\r\n96|92\r\n96|41\r\n96|18\r\n45|63\r\n45|59\r\n45|96\r\n45|29\r\n45|88\r\n45|95\r\n45|16\r\n45|32\r\n45|64\r\n45|78\r\n45|21\r\n45|18\r\n45|22\r\n45|97\r\n45|43\r\n45|41\r\n45|85\r\n45|75\r\n45|79\r\n45|42\r\n45|91\r\n45|56\r\n45|65\r\n45|52\r\n73|11\r\n73|71\r\n73|32\r\n73|13\r\n73|68\r\n73|69\r\n73|97\r\n73|55\r\n73|21\r\n73|81\r\n73|42\r\n73|54\r\n73|85\r\n73|15\r\n73|65\r\n73|45\r\n73|95\r\n73|94\r\n73|64\r\n73|76\r\n73|93\r\n73|27\r\n73|66\r\n73|33\r\n69|32\r\n69|55\r\n69|11\r\n69|66\r\n69|45\r\n69|16\r\n69|65\r\n69|42\r\n69|95\r\n69|96\r\n69|76\r\n69|71\r\n69|59\r\n69|21\r\n69|15\r\n69|63\r\n69|85\r\n69|22\r\n69|43\r\n69|97\r\n69|33\r\n69|64\r\n69|79\r\n69|81\r\n76|52\r\n76|64\r\n76|18\r\n76|91\r\n76|16\r\n76|41\r\n76|21\r\n76|85\r\n76|32\r\n76|59\r\n76|56\r\n76|75\r\n76|42\r\n76|45\r\n76|88\r\n76|97\r\n76|29\r\n76|96\r\n76|79\r\n76|43\r\n76|65\r\n76|95\r\n76|63\r\n76|22\r\n11|29\r\n11|96\r\n11|45\r\n11|43\r\n11|65\r\n11|22\r\n11|76\r\n11|21\r\n11|59\r\n11|56\r\n11|97\r\n11|91\r\n11|85\r\n11|88\r\n11|64\r\n11|52\r\n11|95\r\n11|16\r\n11|32\r\n11|79\r\n11|18\r\n11|63\r\n11|41\r\n53|27\r\n53|15\r\n53|33\r\n53|14\r\n53|92\r\n53|54\r\n53|82\r\n53|55\r\n53|84\r\n53|68\r\n53|94\r\n53|66\r\n53|11\r\n53|69\r\n53|71\r\n53|76\r\n53|72\r\n53|93\r\n53|13\r\n53|73\r\n53|95\r\n53|65\r\n21|63\r\n21|91\r\n21|41\r\n21|53\r\n21|19\r\n21|85\r\n21|43\r\n21|52\r\n21|36\r\n21|16\r\n21|18\r\n21|75\r\n21|64\r\n21|29\r\n21|59\r\n21|79\r\n21|32\r\n21|56\r\n21|96\r\n21|78\r\n21|14\r\n29|55\r\n29|33\r\n29|53\r\n29|71\r\n29|19\r\n29|36\r\n29|94\r\n29|82\r\n29|92\r\n29|54\r\n29|72\r\n29|84\r\n29|13\r\n29|75\r\n29|15\r\n29|14\r\n29|73\r\n29|93\r\n29|68\r\n29|69\r\n64|59\r\n64|79\r\n64|75\r\n64|53\r\n64|88\r\n64|91\r\n64|56\r\n64|14\r\n64|36\r\n64|78\r\n64|41\r\n64|16\r\n64|84\r\n64|18\r\n64|22\r\n64|96\r\n64|29\r\n64|19\r\n64|43\r\n56|54\r\n56|19\r\n56|68\r\n56|72\r\n56|69\r\n56|33\r\n56|94\r\n56|66\r\n56|92\r\n56|13\r\n56|82\r\n56|71\r\n56|93\r\n56|53\r\n56|14\r\n56|81\r\n56|75\r\n56|27\r\n59|68\r\n59|84\r\n59|36\r\n59|54\r\n59|82\r\n59|52\r\n59|53\r\n59|78\r\n59|22\r\n59|91\r\n59|72\r\n59|94\r\n59|56\r\n59|29\r\n59|41\r\n59|92\r\n59|73\r\n42|85\r\n42|21\r\n42|22\r\n42|63\r\n42|97\r\n42|78\r\n42|75\r\n42|36\r\n42|43\r\n42|96\r\n42|32\r\n42|18\r\n42|79\r\n42|91\r\n42|19\r\n42|64\r\n13|32\r\n13|65\r\n13|55\r\n13|69\r\n13|96\r\n13|93\r\n13|63\r\n13|95\r\n13|81\r\n13|71\r\n13|33\r\n13|76\r\n13|85\r\n13|15\r\n13|64\r\n16|22\r\n16|56\r\n16|73\r\n16|19\r\n16|14\r\n16|36\r\n16|53\r\n16|29\r\n16|93\r\n16|52\r\n16|72\r\n16|94\r\n16|92\r\n16|91\r\n79|88\r\n79|22\r\n79|19\r\n79|96\r\n79|56\r\n79|16\r\n79|41\r\n79|43\r\n79|84\r\n79|29\r\n79|14\r\n79|59\r\n79|92\r\n68|63\r\n68|65\r\n68|64\r\n68|93\r\n68|79\r\n68|81\r\n68|55\r\n68|97\r\n68|33\r\n68|15\r\n68|13\r\n68|85\r\n72|95\r\n72|84\r\n72|55\r\n72|93\r\n72|42\r\n72|33\r\n72|69\r\n72|82\r\n72|27\r\n72|45\r\n72|94\r\n78|73\r\n78|76\r\n78|72\r\n78|68\r\n78|11\r\n78|54\r\n78|84\r\n78|15\r\n78|55\r\n78|19\r\n52|36\r\n52|69\r\n52|81\r\n52|82\r\n52|56\r\n52|88\r\n52|92\r\n52|13\r\n52|53\r\n54|43\r\n54|45\r\n54|21\r\n54|32\r\n54|13\r\n54|93\r\n54|15\r\n54|81\r\n95|19\r\n95|36\r\n95|22\r\n95|56\r\n95|21\r\n95|18\r\n95|52\r\n55|88\r\n55|65\r\n55|21\r\n55|32\r\n55|15\r\n55|11\r\n85|36\r\n85|18\r\n85|64\r\n85|72\r\n85|88\r\n14|33\r\n14|72\r\n14|92\r\n14|55\r\n32|16\r\n32|18\r\n32|88\r\n27|32\r\n27|95\r\n36|68\r\n\r\n32,64,63,43,59,16,52,88,91,29,75,19,36,53,14,72,82\r\n56,29,22,85,64,63,43,45,65,41,96,42,75\r\n52,41,14,84,72,78,73,36,68,88,94,91,16,19,13,92,53\r\n85,32,79,52,91,78,14\r\n21,59,43,81,16,45,55,64,11,85,33,42,32,15,22\r\n21,22,41,42,95,45,91,97,96\r\n45,95,21,32,79,43,96,59,16,41,91,18,56,29,75\r\n29,54,88,81,92,27,82,18,69,19,94,68,78,91,84,93,13\r\n22,56,92,52,91,18,19\r\n79,96,88,18,92,19,78,14,59,84,53,72,43,22,56,63,75,82,29,91,41\r\n95,42,21,97,32,64,79,63,43,96,59,16,22,41,88,91,18,56,29,75,19\r\n59,52,88,56,75,14,82,94,54\r\n32,45,11,52,22,85,96,76,41,79,21,88,91,55,63,43,64\r\n66,55,15,11,76,45,42,85,97,32,64,63,96,59,16,22,52\r\n76,45,21,97,79,59,16,22,88,18,56\r\n66,19,94,11,27,33,54,78,36\r\n11,63,81,43,22,96,85,33,16\r\n29,96,43,53,97,85,78,16,14,79,18,63,75,19,22\r\n41,52,88,91,29,75,72,84,73,94,54,13,27\r\n69,84,33,54,13,18,73,81,75,14,93,94,82,36,56\r\n32,64,22,43,96,55,42,15,65,11,71,97,76\r\n56,29,75,78,36,53,14,72,82,84,92,73,94,68,54,13,27,69,81,71,66\r\n65,85,32,91,29,75,78\r\n13,93,69,81,71,66,55,15,76,45,95,85,32,63,43\r\n66,96,79,59,16,11,97,69,33\r\n95,11,64,16,66,76,55,88,15,97,65,41,96,42,21,43,52,79,22\r\n52,88,91,29,78,36,14,84,73,94,54,27,69\r\n97,32,64,79,63,43,96,59,16,22,41,52,88,56,29,75,78,14,72\r\n13,81,54,76,15,85,33,55,97,71,92,45,95,11,65,27,42,73,93,68,21,69,94\r\n91,29,78,19,36,53,14,73,94,54,27,81,71\r\n45,95,63,88,56,96,42,75,85\r\n96,88,78,53,72,82,94\r\n72,75,82,59,36,56,16,18,78,41,52,22,29,92,94,68,73\r\n91,18,56,29,75,19,36,14,72,82,84,92,94,54,13,93,69,81,71\r\n73,94,54,13,93,27,69,71,33,66,11,76,65,95,42,21,85,97,32\r\n84,92,81,33,66,76,45,95,85\r\n27,33,15,11,76,45,65,95,32,63,59\r\n78,88,96,14,41,72,64,36,84\r\n82,92,73,93,69,81,66,55,15,45,65,42,21\r\n68,54,69,81,33,66,95,85,79\r\n91,22,59,82,84,29,18,56,96,14,94,53,43,75,73,52,88\r\n27,94,93,53,56,75,78,84,72,41,82\r\n82,65,45,54,15,53,71,13,55,68,66\r\n54,13,93,27,69,81,71,33,66,55,15,11,76,45,95,42,21,85,97,32,64,79,63\r\n93,76,97,69,15,92,73\r\n64,79,96,18,56,29,75,78,19,53,72,82,84\r\n84,92,73,94,68,54,13,93,27,69,81,71,33,66,15,11,76,45,65,95,42,21,85\r\n36,22,52,16,78\r\n14,72,82,84,92,73,94,68,54,13,93,69,81,71,33,66,55,15,11,76,45,65,95\r\n56,92,54,84,27,73,13,93,19\r\n33,84,11,14,92,72,71,95,94\r\n85,32,55,76,33,59,79,66,95,11,63,21,96\r\n27,75,71,92,72,68,36,93,69,53,14,19,81,82,54,56,18,29,33,13,94,78,84\r\n69,94,13,85,97,95,93,81,64\r\n71,21,63,96,81,22,85,95,76,97,59\r\n65,63,96,76,42,95,71,16,55,11,21\r\n92,41,94,56,68,84,22,19,91,88,53,14,54,73,72,75,13,18,36\r\n36,53,14,72,82,84,92,73,94,68,54,13,93,27,69,81,71,33,66,55,15,11,76\r\n65,81,13,33,11,76,93,42,45,73,15,55,95,84,92,85,71,21,54,66,27\r\n59,16,22,41,88,91,56,29,75,78,19,36,14,82,84,92,73,94,54\r\n94,27,42,33,84,72,81,93,82,71,65\r\n66,21,15,33,32,27,55,54,95,69,76,71,73,65,42,85,81,45,97,13,68\r\n53,27,93,19,82,33,81,69,36,54,94,71,72,66,73,76,15,14,13\r\n29,75,19,36,53,14,82,84,92,73,94,68,54,13,93,27,69,71,33,66,55\r\n14,88,82,36,78,91,63,43,22\r\n22,91,18,56,29,14,92,73,93\r\n85,59,41,88,18\r\n63,43,59,16,41,88,56,29,75,19,14,82,84,92,73\r\n97,32,64,79,63,43,96,16,22,41,52,91,29,78,19,36,53,14,72\r\n95,33,65,13,72,76,92,14,55\r\n64,65,52,78,91,97,96\r\n71,78,84,56,27,93,36,72,94\r\n69,66,93,72,55,15,92,13,45,68,11,27,73,54,76,95,84,94,71,42,33,65,82\r\n36,72,92,73,94,68,27,69,81,33,66\r\n22,41,52,18,29,75,78,53,14,72,82,84,92,94,68,54,93\r\n43,96,16,41,52,88,91,18,29,78,19,36,53,14,72,82,84,92,73\r\n97,21,27,15,76,96,95,42,45,11,81,32,79,33,69,59,63,85,43,65,64,66,71\r\n54,81,21,93,68,85,97,73,76,55,11,42,95,69,33,66,71,45,65,15,92\r\n32,42,64,15,18,45,79\r\n15,66,84,54,45,93,95,33,69,65,55,82,27,71,68\r\n73,53,27,56,36,14,69,66,54,68,92,75,29,94,93,13,78,84,72,33,19,82,81\r\n15,65,27,32,69,45,73,71,85\r\n64,22,91,36,72\r\n66,55,11,76,45,65,95,42,21,85,97,64,79,43,96,22,41,52,88\r\n66,68,69,79,45,55,11\r\n75,78,19,36,82,84,13,81,71\r\n71,55,65,95,85,97,32,64,79,96,59,22,41\r\n53,14,72,82,84,92,73,94,13,93,69,81,33,66,55,15,11\r\n72,68,27,94,14,71,91,56,81,78,73,82,18\r\n15,69,96,93,95,21,33,55,42,97,63,85,11\r\n64,71,45,27,97,94,93,15,65,55,68,42,54,81,66,69,21\r\n78,36,14,72,82,92,73,94,68,54,13,93,69,66,55,15,11\r\n68,84,78,56,27,75,13,69,82,18,14,93,81,54,71\r\n76,45,65,21,85,97,64,79,63,43,59,16,22,41,52,88,18,56,29\r\n97,88,52,43,36,18,96,29,16,41,64,59,75,56,63,19,72\r\n78,53,14,72,82,84,73,68,54,13,27,66,55,15,11\r\n96,16,22,52,88,18,56,29,75,78,19,36,53,72,82,84,92,73,68\r\n88,56,59,63,29,14,43,32,97,53,96,52,91\r\n63,95,85,18,16,78,22,32,91,97,21,88,41,43,29,56,64,52,19\r\n14,72,82,94,54,13,93,27,69,33,66,55,15,76,45,65,95\r\n96,29,75,41,18,73,94,68,56,36,59,52,16,91,53,88,92,82,84,22,72,14,78\r\n95,32,79,91,18,29,19\r\n95,42,21,85,97,32,64,79,96,16,41,52,91,29,75,78,19\r\n11,93,94,68,81,71,69\r\n96,92,75,82,56,22,91,14,88,29,41,94,19\r\n66,55,15,11,45,65,95,42,21,85,97,32,64,79,43,96,59,16,22,41,88\r\n66,15,95,42,21,85,32,64,63,96,59,16,22,41,52\r\n22,52,55,59,41,45,33,64,16,76,96,43,79,11,95,32,63,65,85\r\n41,19,18,95,96,16,52,85,88\r\n59,16,41,32,63,64,21,55,97,42,95,91,15,79,65\r\n63,16,96,97,95,91,88,42,21,85,15,18,64,32,22,79,76,11,65,59,45\r\n93,21,66,69,32,15,97,55,64,45,54,79,27,33,71\r\n14,72,82,84,92,94,54,13,93,27,69,81,71,66,55,15,11,45,65\r\n66,55,81,71,69,84,36,29,27,13,82,33,14,73,68\r\n27,29,81,68,36,92,78,53,54,71,14,66,93,72,19,55,13\r\n32,91,53,18,96,56,64,59,21,43,78,19,63,36,79,22,88,16,85\r\n16,75,22,96,78,41,52,53,91,84,64\r\n81,68,78,88,73,82,56\r\n92,73,94,68,54,13,93,27,69,81,71,33,11,45,95,42,21,85,97\r\n73,85,11,27,54,95,65,42,93,32,81,33,66\r\n13,93,55,15,64,63,43\r\n72,82,84,92,73,94,68,54,13,93,27,69,81,71,33,66,15,11,76,45,65,95,42\r\n54,13,93,27,69,81,71,66,55,15,11,76,45,42,21,85,97,32,64,79,63\r\n27,53,19,41,75,88,56,54,92\r\n66,27,15,92,84,94,55,11,81,95,42,73,65,45,76,21,71,85,54\r\n43,14,52,41,36,88,92,18,82,72,96,94,53\r\n85,97,64,43,16,22,52,78,14\r\n75,36,53,72,13,33,15\r\n59,52,42,19,64,88,36\r\n78,97,29,36,18,53,91,16,14,79,43,19,85,63,59,22,75,88,64,52,96\r\n53,73,93,71,55,76,65\r\n93,69,81,71,15,45,21,85,97,63,96\r\n56,92,14,88,93,73,84,52,72,36,82,27,78,19,18,69,75,68,53,91,29,94,54\r\n81,84,92,15,68,27,42,95,13,11,69,66,76,33,72,55,71,45,82\r\n71,66,15,45,65,95,42,21,85,97,32,64,43,22,41\r\n19,73,54,27,81,71,76\r\n92,68,82,36,18,91,93,41,19,75,27,84,53\r\n82,84,92,73,94,54,13,93,27,81,33,66,55,15,11,76,45,65,21\r\n43,41,16,96,14,29,64,22,78,36,18,88,56,53,72,52,59,75,82\r\n72,82,84,92,73,94,68,54,13,93,27,69,81,71,33,66,55,15,11,76,45,65,42\r\n43,59,16,41,36,84,94\r\n13,93,69,81,71,33,66,55,15,11,76,45,65,95,42,21,85,64,79,63,43\r\n16,52,18,29,78,14,82,92,73,54,13\r\n97,64,43,41,29,14,72\r\n18,29,75,78,19,36,53,14,72,82,84,92,73,68,54,13,27,69,33\r\n71,42,65,63,97,76,54\r\n55,43,45,16,85,79,65,11,64,59,42,63,97,33,96,95,41,22,66,15,76,71,32\r\n75,19,53,14,73,54,27,69,81,33,66,55,15\r\n11,76,45,65,85,97,64,79,63,43,96,16,22,52,88,91,56\r\n88,52,29,42,59,56,36,22,97,91,41,19,85,79,21,96,32,18,78,16,75\r\n65,95,42,21,85,32,64,79,63,43,96,59,16,41,52,88,91,18,56,29,75\r\n71,33,66,55,15,11,76,45,65,95,42,21,85,97,32,79,63,43,96,59,16,22,41\r\n21,85,16,41,52,91,18,56,29,75,53\r\n56,45,85,43,75,41,21,22,59,52,63,42,32,29,64\r\n85,95,75,91,52,96,88\r\n33,97,66,32,13,76,65,42,94,81,64,21,11,95,93,55,45\r\n88,91,18,56,29,75,78,19,36,53,14,72,82,84,92,94,68,54,13,93,27,69,81\r\n22,16,65,59,95,33,66,81,63,64,76,42,97,43,15\r\n81,15,69,82,65,84,14,92,33,13,45,68,72,55,93,94,11,71,95\r\n27,68,91,56,19,13,93,69,92,73,81,18,78,82,29,88,72,53,36,14,75\r\n78,36,85,59,16,97,52,42,64\r\n79,63,96,59,16,22,41,52,91,18,56,75,78,19,36,14,72,82,92\r\n15,69,32,43,13,66,93,45,79\r\n97,64,79,63,43,59,16,41,52,88,91,18,56,29,75,78,19,36,53,14,72\r\n29,92,68,84,52,75,91,56,19,22,53,88,72,36,18,82,41,73,14\r\n84,59,22,18,16,64,91,53,88,63,29,72,19\r\n27,56,72,29,92,81,53,69,73,36,94,54,68,82,78,33,71,18,13\r\n68,92,53,91,36,29,18,78,72,84,73,94,13,93,81,19,27,88,54\r\n21,13,68,94,33,45,11,54,71,66,69,55,73,65,81\r\n93,29,13,19,92,36,91,52,88,78,56,73,27,84,69\r\n56,75,72,82,73,81,66\r\n85,73,68,21,54,76,95,55,45,94,32\r\n66,45,65,95,42,97,64,43,22,41,52\r\n63,32,43,59,85,41,95,42,88,55,96,22,97,91,65,76,11,21,16,15,64,45,52\r\n45,43,11,66,55,64,63,93,95,69,81,13,21,79,15,97,27\r\n64,32,88,79,41,22,18,75,56,96,91,21,45,29,59,52,85,63,95\r\n69,81,71,33,15,11,76,95,42,85,97,64,79,43,96,59,16\r\n15,68,13,66,71,93,11,94,19,92,36,69,27,82,81\r\n43,71,96,41,85,97,76,63,66\r\n95,97,64,96,43,79,93,85,69,66,32\r\n22,41,52,88,91,18,56,29,75,78,19,36,53,14,82,84,92,73,94,68,54,13,93\r\n82,76,72,14,71,33,19,36,93,13,73,92,94,53,84,55,11,81,54,69,66,15,27\r\n72,32,19,22,56,59,36,16,91,96,82,88,29\r\n79,65,95,85,11,52,56,42,21,91,16\r\n16,22,56,29,78,19,36,53,84,92,73,94,68,54,13\r\n96,84,19,53,94,88,68,72,36,52,59,92,22,56,78,14,16,41,75\r\n22,52,91,18,19,14,68,54,93";

    protected override string Part1Internal(string input)
    {
        var sections = input.Split(Environment.NewLine + Environment.NewLine);
        var rules = sections[0].Split(Environment.NewLine).Select(a => a
            .Split('|').Select(int.Parse));
        var prints = sections[1].Split(Environment.NewLine).Select(a => a.Split(',').Select(int.Parse).ToArray());

        var counter = 0;

        foreach(var print in prints)
        {
            var printedPages = new HashSet<int>();
            var fail = false;
            foreach(var page in print)
            {
                printedPages.Add(page);
                var selectedRules = rules.Where(a => a.First() == page).Select(a => a.Last());
                if (selectedRules.Any(a => printedPages.Contains(a)))
                {
                    fail = true;
                    break;
                }
            }

            if (fail)
            {
                continue;
            }

            var middle = print[(print.Length - 1) / 2];
            counter += middle;
        }

        return counter.ToString();
    }

    protected override string Part2Internal(string input)
    {
        var sections = input.Split(Environment.NewLine + Environment.NewLine);
        var rules = sections[0].Split(Environment.NewLine).Select(a => a
            .Split('|').Select(int.Parse));
        var prints = sections[1].Split(Environment.NewLine).Select(a => a.Split(',').Select(int.Parse).ToArray());

        var incorrectPrints = new List<List<int>>();

        foreach (var print in prints)
        {
            var printedPages = new HashSet<int>();
            foreach (var page in print)
            {
                printedPages.Add(page);
                var selectedRules = rules.Where(a => a.First() == page).Select(a => a.Last());
                if (selectedRules.Any(a => printedPages.Contains(a)))
                {
                    incorrectPrints.Add(print.ToList());
                    break;
                }
            }
        }

        foreach(var print in incorrectPrints)
        {
            var selectedRules = rules.Where(a => a.All(b => print.Contains(b))).ToArray();
            var brokenRules = new Queue<IEnumerable<int>>(selectedRules.Where(a => print.IndexOf(a.First()) > print.IndexOf(a.Last())).ToArray());

            while (brokenRules.Any())
            {
                var r = brokenRules.First();

                print.Remove(r.First());
                print.Insert(print.IndexOf(r.Last()), r.First());
                
                brokenRules = new Queue<IEnumerable<int>>(selectedRules.Where(a => print.IndexOf(a.First()) > print.IndexOf(a.Last())).ToArray());
            }

            Console.WriteLine(string.Join(',',print));
        }

        var result = incorrectPrints.Sum(x => x[(x.Count() - 1 )/ 2]);
        return result.ToString();
    }
}
