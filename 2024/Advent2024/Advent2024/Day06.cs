using AdventUtils;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Advent2024;

internal class Day06 : DayBase
{
    protected override string _sample1 => "....#.....\r\n.........#\r\n..........\r\n..#.......\r\n.......#..\r\n..........\r\n.#..^.....\r\n........#.\r\n#.........\r\n......#...";

    protected override string _part1 => ".....#..#................#...###..............................#..#.......................................#........................\r\n..................#...........#.............#.#.#.#......................#.......##.........................................#.##.#\r\n....#.......................................................#.......#.........................#...................................\r\n.#.............#...........#..........................#.....................................................................#.....\r\n....#..#................#..........................#..#..#...#..........#....................................#.#..................\r\n...........................#....#.##......................................................................##...................#..\r\n...........................#.....................................#....##.#..#..#.....#................#...........................\r\n.....#..............#........#........................................###...........#..................................#..........\r\n........#..............#............................................................#..............................#..............\r\n......#..............................#..........................#................................................#................\r\n................#..#......................#.......................................................................................\r\n..#.............................##.....#.......................................................#..................................\r\n#.......................................#...#.............................#...........#.#.........#.............#.................\r\n..............................#................................#...#................................................#.............\r\n..............#...............#.................#........................#...#.....#................#.............................\r\n...................................#...#...........#...............#.........#............#...............##...........#.#........\r\n.........................#..................................................................#.........#...........................\r\n.##.............#................................#.......#.........#..............................................#...............\r\n....#.................#.....#.......................................................#......................#......................\r\n#..................................#................#......#.........................#............................................\r\n.....#..................#................#........................................................................................\r\n......#......#.......#......#.#....................#..................................#...................#...#...............#.#.\r\n.................................................#......#......#.........#..................#.....................................\r\n...........#.....#..................................#...#........#......#...#..................#.##....#.................#.......#\r\n........#..#....................................#...................................................................#.......#.....\r\n...........#..............#.............................................#..............#.#........#..##.................#.......#.\r\n......................................#............................................#...#..........................................\r\n.......#.............#............................#.........#................#.......................................#............\r\n..........................................................................#.............#...............................#.........\r\n......##...............#..........................................................................................#...............\r\n.........#..#................................................#..................................#.......#.....................#...\r\n...#..............................#.#.............#........................#..............#..............................#........\r\n.......................................................................................................#.............#............\r\n.....#.......................#..#..........#.....................................................................................#\r\n..........##..........................#...............................#.......................#...............#.............#..#..\r\n..#....#....................#.............#......#.............................................................#..................\r\n.#....#..........................................................................................#.#......#.....................#.\r\n..........................#.......#......................................................#........................................\r\n.#......#.#......................................................................#........#.........#.........#.#.................\r\n.....................................#........#..........#.............................#..#............#....................#.....\r\n............#.........#.........................................................................................#........##.......\r\n....................#.................#.........................#......................#......................................#...\r\n............#....................................................#..#.........#..........#...................................#....\r\n#.....#...................#.........#.#..................................................................................#........\r\n.............................##.......#........................................#..........#..............#..#.....................\r\n.............#....................................^.##....................................................#.....................#.\r\n........................#.#..#......................#............#...#..........................#.......................#.........\r\n......................#.......................................................................#.#..#......................#.......\r\n..................................................#.......##...................................#..................................\r\n.............................#..........................................#..............#.#.............................#..........\r\n....#.............#..................#.....#..........................#....#..........#.........#........................#.......#\r\n...............#...........................#...............#....................................................................#.\r\n..........................#.............#..........................................................#..............................\r\n...............#...................................#.......................#.............................#...............#........\r\n....#......................##......#.#................................................#................#.............#............\r\n.......#...................#..........................................#.....................................#.....................\r\n.#.....................#..........................................................................................................\r\n........#.#...........#....#...................................#..#.#....#..................#.#...............#......#........#...\r\n#....#............#...#.........#...........#......................#.....................#........................................\r\n........................#.............#.................................................................#.....#...................\r\n...............#....................#................##...#...........#.#..............#..........................................\r\n........................#...........##.......#.....#...........................#..#...................................#...........\r\n.............#........................................................................#.....#.#.#.................##..............\r\n......#......................#.........#..............#...............#................#..................#........#..............\r\n..........#..........................................................................................................#............\r\n..................#...........#................#..#.#..............#.#........#...............................#....#..........##..\r\n...........#..............#...................................................#...................................................\r\n..................................................................#............#............................#.................#...\r\n....#...........#...................#..........................................#..........#...........................#...........\r\n........................................#....................#....#..#........................#.....#.............................\r\n................#........................................................................................................#........\r\n...................#......#.....#..............#..................................#...#.............#........................#....\r\n...................#............................................................#.............#...................................\r\n.......#........................#..........#.............#....#....#.............#.............................#...#..............\r\n...#...............##.............................................................#.................#........................#....\r\n.............................#.................#..................#.#....................#.....................................###\r\n...............#....#.....................................................#..............................................#.......#\r\n....................................#..................................#.......................#..................................\r\n#..#............#................................#....#...............#.........#...........................#.....................\r\n...........................................................................................................#.............#....#..#\r\n...................................#....#.........#..................#......#....................#..........#.....................\r\n...........#.............................................................##.#......#.....#......................#...#.............\r\n..#...................................................................................#.................#.........#...............\r\n.......#..#..#.................................#.....................#..............................................#....#........\r\n..........................#....................................................................................................#..\r\n..#.............#......#..................................#..#.......................#..........#...#...##......#.................\r\n....#...................#....#.........................................................#..................................#.......\r\n.................................#...............#.....................#..#.......................................................\r\n...........#......................................................................................................#...........#...\r\n.............#.................................................................#............#..................#........#.........\r\n.......................#.......#..........................................................#...............................#.....#.\r\n...........................................................................#....#....#............................#...............\r\n....................#............#................................................................................................\r\n.....#.........................................#...................#.....#...#.......#..............#............................#\r\n...#.......................................#.........#............#...................#......................#....#............##.\r\n...##.#...........................................#...#................#..........................................................\r\n.......#..##............#..#............#......................................#...............#...........#.........#......#..#..\r\n...............................................................................#.........##........##.............#...............\r\n......#...............................#.........#............#..............................#.........................#....#......\r\n#...........................#....#..#....................................................#..................#.....................\r\n......#.##.......#...........................#...#........#.................................................................#.....\r\n..........#.................................................#..........................................#....#.#.........#.#.#.....\r\n...#...#.....#......#.......#..#.#.........#...............................................................#..........##.........#\r\n..#...#...#..........................................#............................#..........#..........#.........................\r\n#....#............#......#.............#.#.......##...............#................#.............................#................\r\n...............................#...............................................................#..............#.........#.........\r\n....#..............#..#............................................................#.......#................#...................#.\r\n....#...........................#.............................#.............#....#.........#....#...................#.......#.#...\r\n.......#.......................................#....#........#..............#........#....................#.......................\r\n........#...........................#................................#............................................................\r\n...........#....#........#......................................#...........#.................................#..........#........\r\n........#..........................................................................................#...........................#..\r\n#........................................#.................................................................##...#.....#...........\r\n............#..............#...........#............#................#..#.......................#.#.....#.............##..........\r\n..........#..................#..................................................................................................#.\r\n.....................................#..............##..................................#.............#........#..................\r\n..............................#..................#...............#......#..##....................#................................\r\n..#............#....................................#.......................................................#...#.................\r\n..................###..........................#.......#.................................#........................................\r\n.....#.#..........................................................#...........##...#.....#.................................#......\r\n.............................................#.............................#......................#.............#.......#.....#...\r\n...#......................#............#..................................#........................#....................#.......#.\r\n....##..........#..........#...#.............#............#....#......#....................#...........#..#..........#............\r\n..#......................#............#..#..#.......................#.........#......#...............#............#..#............\r\n..#.............#.#.............................#......#......#.........................#......#.#...............#...............#\r\n...#...........#...............#.....................................#.................#....#....#...................#.#...#......\r\n.......#........#....................#.............................................#..............................................\r\n........#............................#....#....#........#...................#.#...............#...#.....................#.........\r\n.##........#.................#...........#...............................##.#.....................................................\r\n.###...........................#........#..#................................................#...........................#.........";

    protected override string Part1Internal(string input)
    {
        var lines = input.Split(Environment.NewLine);

        var startCoords = (Row: 0, Column: 0);

        var row = 0;
        foreach(var l in lines)
        {
            if (l.Contains('^'))
            {
                startCoords = (row, l.IndexOf('^'));
                break;
            }

            row++;
        }

        var direction = Direction.Up;

        var counter = 0;
        var visitedLocations = new HashSet<(int Row, int Column)>();

        var finished = false;
        while (!finished)
        {
            visitedLocations.Add(startCoords);
            var path = GetPath(direction, startCoords, lines);
            var block = path.IndexOf('#');
            var newCoords = (0, 0);

            if (block < 0)
            {
                block = path.Count - 1;
                finished = true;
            }

            switch (direction)
            {
                case Direction.Up:
                    newCoords = (startCoords.Row - block, startCoords.Column);
                    for (var i = startCoords.Row - block; i <= startCoords.Row; i++)
                    {
                        visitedLocations.Add((i, startCoords.Column));
                    }
                    break;
                case Direction.Down:
                    newCoords = (startCoords.Row + block, startCoords.Column);
                    for (var i = startCoords.Row; i <= startCoords.Row + block; i++)
                    {
                        visitedLocations.Add((i, startCoords.Column));
                    }
                    break;
                case Direction.Left:
                    newCoords = (startCoords.Row, startCoords.Column - block);
                    for (var i = startCoords.Column - block; i <= startCoords.Column; i++)
                    {
                        visitedLocations.Add((startCoords.Row, i));
                    }
                    break;
                case Direction.Right:
                    newCoords = (startCoords.Row, startCoords.Column + block);
                    for (var i = startCoords.Column; i <= startCoords.Column + block; i++)
                    {
                        visitedLocations.Add((startCoords.Row, i));
                    }
                    break;
            }

            direction++;
            if (direction == Direction.Turn) direction = Direction.Up;
            counter += block;

            startCoords = newCoords;
        }

        return (visitedLocations.Count + 1).ToString();
    }

    private List<char> GetPath(Direction direction, (int Row, int Column) startCoords, string[] lines)
    {
        List<char> path = null;
        switch (direction)
        {
            case Direction.Up:
                path = lines.Where((a, i) => i < startCoords.Row).Select(a => a[startCoords.Column]).Reverse().ToList();
                break;
            case Direction.Down:
                path = lines.Where((a, i) => i > startCoords.Row).Select(a => a[startCoords.Column]).ToList();
                break;
            case Direction.Left:
                path = lines[startCoords.Row].Substring(0, startCoords.Column).Reverse().ToList();
                break;
            case Direction.Right:
                path = lines[startCoords.Row].Substring(startCoords.Column + 1).ToList();
                break;
        }

        return path ?? new List<char>();
    }

    private enum Direction
    {
        Up,
        Right,
        Down,
        Left,
        Turn
    }
}
