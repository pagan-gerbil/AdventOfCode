namespace Day16
{
    internal class Program
    {
        static void Main(string[] args)
        {
            var input = _input;

            var grid = input.Split(Environment.NewLine).Select(x => x.ToArray()).ToArray();

            Puzzle1(grid);
        }

        private static void Puzzle1(char[][] grid)
        {
            var visited = new HashSet<Travel>();
            var total = 0;
            var start = new Travel(0, -1, Direction.East);
            var queue = new Queue<Travel>(new[] { start });

            while (queue.Any())
            {
                var current = queue.Dequeue();
                if (visited.Contains(current))
                    continue;

                if (current != start)
                    visited.Add(current);

                var next = GetNext(current);
                if (next.Col < 0 || next.Col >= grid[0].Length || next.Row < 0 || next.Row >= grid.Length)
                    continue;

                switch (grid[next.Row][next.Col])
                {
                    case '.':
                    case '|' when (next.Direction == Direction.North || next.Direction == Direction.South):
                    case '-' when (next.Direction == Direction.East || next.Direction == Direction.West):
                        queue.Enqueue(next);
                        break;
                    case '|' when (next.Direction == Direction.West || next.Direction == Direction.East):
                        queue.Enqueue(new Travel(next.Row, next.Col, Direction.North));
                        queue.Enqueue(new Travel(next.Row, next.Col, Direction.South));
                        break;
                    case '-' when (next.Direction == Direction.North || next.Direction == Direction.South):
                        queue.Enqueue(new Travel(next.Row, next.Col, Direction.East));
                        queue.Enqueue(new Travel(next.Row, next.Col, Direction.West));
                        break;
                    case '\\':
                        switch (next.Direction)
                        {
                            case Direction.North: queue.Enqueue(new Travel(next.Row, next.Col, Direction.West)); break;
                            case Direction.South: queue.Enqueue(new Travel(next.Row, next.Col, Direction.East)); break;
                            case Direction.East: queue.Enqueue(new Travel(next.Row, next.Col, Direction.South)); break;
                            case Direction.West: queue.Enqueue(new Travel(next.Row, next.Col, Direction.North)); break;
                        }
                        break;
                    case '/':
                        switch (next.Direction)
                        {
                            case Direction.South: queue.Enqueue(new Travel(next.Row, next.Col, Direction.West)); break;
                            case Direction.North: queue.Enqueue(new Travel(next.Row, next.Col, Direction.East)); break;
                            case Direction.West: queue.Enqueue(new Travel(next.Row, next.Col, Direction.South)); break;
                            case Direction.East: queue.Enqueue(new Travel(next.Row, next.Col, Direction.North)); break;
                        }
                        break;
                }
            }

            Console.Write(visited.Select(x => (x.Row, x.Col)).Distinct().Count());
        }

        private static Travel GetNext(Travel current)
        {
            switch(current.Direction)
            {
                case Direction.North: return new Travel(current.Row - 1, current.Col, Direction.North);
                case Direction.South: return new Travel(current.Row + 1, current.Col, Direction.South);
                case Direction.East: return new Travel(current.Row, current.Col + 1, Direction.East);
                case Direction.West: return new Travel(current.Row, current.Col - 1, Direction.West);
                default:
                    return null;
            }
        }

        private record Travel (int Row, int Col, Direction Direction);
        private enum Direction { North, South, East, West };

        private static string _test = ".|...\\....\r\n|.-.\\.....\r\n.....|-...\r\n........|.\r\n..........\r\n.........\\\r\n..../.\\\\..\r\n.-.-/..|..\r\n.|....-|.\\\r\n..//.|....";
        private static string _input = "\\.......................\\..........................................-..................-.../................-..\r\n....../.......\\...-......-.|...\\..............\\.................|............././....-........................\r\n...............-...-........................................\\......\\..-.............|......-....\\....-........\r\n..\\..|.|...........................-.|........................................./.|....|................|......\r\n|../................|............................................................\\........../..\\..............\r\n........\\............../................/..........................\\...\\....|............./....-.........\\\\...\r\n.................-...-...................\\../........-|.................../......-...........|................\r\n........-............/...|-............-.....\\.|..............-....-../\\../..................\\...\\././........\r\n........................-|................................................................-........-..........\r\n-......./.................|.....\\.................\\.....//............-........./..../....|...................\r\n....-.............-........-..........-|.......|...../...\\...................\\.....................|..........\r\n...|...\\.........|.................|.....|....-....\\.......\\./........................-.../..../.....-........\r\n....|....-.-..............\\.........|.......................-.......-..............\\................/.........\r\n.....|.\\...........-.................-.-........../...\\............|...............|...|......./.......|...../\r\n.....\\.........................-.../..-./...\\...................../......\\...-.......|.\\........-|............\r\n............|.....................................-....../....\\.............../-...|...\\..\\................./.\r\n......-./|....../............|.........\\............-../...-......./.\\..\\....../......|/...\\..................\r\n................................|.......|..-..../.............................../.-..................-..-/..|.\r\n...............................-......./......................|./...............-............./....../........\r\n..................../....................\\........\\...........................-............/.../..............\r\n.|||......../.................|.................../..\\............................-......./..|...|/.-.........\r\n......-......./\\....../.........|....../.......-...............|.\\........-............/.../..................\r\n.....................-.\\/|................//.../.........|.|......\\.-..|.........|.........\\..................\r\n.........................\\/.......|.|............................|........|.............................././..\r\n.................................|.................\\../..|/.................\\.................-...-........-/.\r\n......................-...-.........../...........................\\....\\......-..-.......\\.-....\\....|........\r\n......-......../..............\\/..................\\..|........-..............|...-...../......|...............\r\n|.......|.../....|..............//.....................|..........|/......../................|................\r\n...|.|..................../|..../.-.......-...........|.....|./....\\......-......-................|...........\r\n......\\/./.|\\..../|.|..|..........-....|...........|.-.|...................-.\\.....|....................\\.....\r\n......../.\\......................|.....|...........|.........../.......|....|...|.......-......../......\\...-.\r\n...|...-...||......-..|..-...........|.-.................|.................................-..................\r\n..............-.\\.-........|......\\..........................................\\./.\\........../.....|...........\r\n../\\.........|...............|............|.\\/.-/.................-....|...-.................-.....|..../.....\r\n....................../......../..../-.....\\........................\\..-.\\....|....-.........../-.............\r\n.................................|................|.........|................../|.....|....\\\\............/.\\..\r\n...///./.....\\.................|/.....................\\...................-............|................|.....\r\n............-...........................--........\\................/.............-\\................\\.....-.../\r\n...............\\.........../|............................|.....................\\...-...\\.....................-\r\n...\\.............|.............|................\\............\\|...../...|.........................|...........\r\n..................|......|..........-.-..............\\.........................\\..............................\r\n....-................../.........../...|................/...............|./.|.../....\\..../......./......//...\r\n...../....../..............................|...\\../..........-..........-........-..//..../...................\r\n...............-......|......................|./........./............/..-...........|../.....-........-./....\r\n..\\.........................|...-.......\\.................|..............-........\\....-.............-....|...\r\n.......|......|....../........\\...........|......-........../......-..................../....................\\\r\n.......................|....-..|........./.|.-...............|..\\......\\.....-.......\\...-/....|/.........\\...\r\n\\......\\..-.....................\\..........................\\................................../...........\\...\r\n-....-......../............................................................../.\\.......|..............|....-..\r\n........|......................|.............-....\\................................./..\\.......|..........-...\r\n...-...............|........./......\\...../.......|...|...............\\.../...\\.../......|.....-.\\......\\.....\r\n............./.....|......................|.....................................\\...||.................-....|.\r\n./.....-................/........|./....-......../......./..............\\..................................\\..\r\n.../..../\\........-..........................|.-/.|..\\................\\\\-.......|......./...||.......|........\r\n.....-.........................-...............\\...........|.............-.\\.../.|......-.|......../...-.....-\r\n......\\....................|...../......................|.../......-..|............|......./.../.........|....\r\n...|...........-....................................../.|............./....|..../........./.....\\../..........\r\n....../.../................\\........................\\...\\....\\......\\............../|...............\\.-.......\r\n./....\\.../.............|............................-.../............../............/...........\\...|........\r\n............................|.................|/..........//.........../..-...............|...................\r\n.....\\......\\.................|.....|...\\-./...............\\................|....../.....-..\\........-....-...\r\n........................./-........\\................./........-/.|....-.......\\............-/\\......|.\\...-...\r\n..../../..|.|...............\\.......................................-.........................................\r\n...........|...................................................-...-......|..................\\............../.\r\n/....|......................................................................|\\.../.......-...........-...|....\r\n......|.-.\\......-........|.....-..|.\\..............-......./......-|.........................-...............\r\n............\\......................................|........................|.-...............................\r\n.........-.........../....\\./....../.-...-..//.........../.......\\\\...........................................\r\n........\\......../............./...-......\\.../..|..|............................../......../..\\..............\r\n--.........|.....-...|............../...|.......|..............\\|............|.........................|.-....\r\n-\\......./..............-....-....\\...|.-........\\/.\\./............-/...\\........|-.........../../...\\........\r\n.\\|\\..............-......-.\\...-....\\..........................\\........|...........-......./.............../.\r\n..........................|...\\..../.../..........\\.............-...//...............\\..................-.....\r\n........./..........................\\............|-.....|..-...|......../........-...........................\\\r\n.......\\.../.....\\....../.......|..|...............-......................|....-...................-.|........\r\n......|.......\\.../..............................-..............................|......-.-...................\\\r\n/.....|.......-............/|.....|-......./..../......-........../..|......../.-..\\..../....../...|..........\r\n............/..--..........-............\\.......\\................\\........................../../....|.........\r\n..|..-................|.|..|................/.......\\............-//.......................\\..\\...............\r\n.......................-......-..................|....\\................-......\\.|....\\....|..../../|.-........\r\n........................-..................-...........................-..-................-................|.\r\n/.\\....|.-.................................\\..-.....\\./.........../-.|..............\\..\\.....--|/....\\........\r\n.......-..-../..................\\..--|..............|...............|\\........|...--................|./.\\.....\r\n..........|................-.......|..................................................|...................|...\r\n-.-..|....-.|........-./...|.-.........\\.....\\/........-........\\........../................./.../........\\...\r\n..................../...|/......................................../............\\.|./../................/\\|....\r\n...//.........................\\....../..............\\../.......-..\\....|......................................\r\n............................./..|./../.........-/..\\..........................................................\r\n......\\.....|..................|..................\\.....\\.-..\\...../............................../...........\r\n..........\\...........-..........-.....-....\\/................../.................................\\.....|..\\..\r\n..../.\\...................................\\............\\...\\....|.................|.....................-.....\r\n...........-...........................\\.......|-../.|....|.....|......................-...../................\r\n.......|.........\\..............|....\\...-......../...........-.....-..-...........-..................\\...\\.|.\r\n...........|.......................|....-..........\\............................\\.................../.\\.......\r\n..../.................\\.......-..|.................../........................|...............\\...........-.|.\r\n............./..|.-\\..../.....-............-....|..\\......|......../............-.........|................\\..\r\n...................\\...\\/......\\............|......................\\....|...................-./-..............\r\n..-\\...........|.................../.....|....|............................-..|............\\.............\\....\r\n.|.....\\....\\........|..................\\...............|..-/.........|.-/...........-............-...........\r\n.....\\...../......-............|........./..|............-........................\\....-......................\r\n......\\......../........|..............\\...-..-...|.......................................................|...\r\n...................|.................................\\.....\\...........................|../.|.-......-........\r\n..................|..............\\.....\\............|........../....../...............\\.........\\.............\r\n..|...........-..../....\\.........--...\\................../.............-...-....................-..../....|..\r\n.|...\\...................|......-...........-\\..........\\.....|.....|..........|.........|....|-../...........\r\n.............\\|...................../\\...............\\....../.......-....\\.....................-..............\r\n.......//.....................\\....\\......\\......\\.........|...................../......../.........\\......-..\r\n.\\./.........-...-./-.\\.............../......|................................\\|....\\...../....-..............\r\n.......|......../......../......./.........../...............|............................../..|......../.....\r\n............./.........|.....-./.........../....-......./|......-................|............................";
    }
}
